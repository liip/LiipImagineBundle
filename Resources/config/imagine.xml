<?xml version="1.0" encoding="utf-8" ?>
<container xmlns="http://symfony.com/schema/dic/services"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://symfony.com/schema/dic/services http://symfony.com/schema/dic/services/services-1.0.xsd">

    <parameters>

        <!-- Utility classes -->

        <parameter key="liip_imagine.filter.manager.class">Liip\ImagineBundle\Imagine\Filter\FilterManager</parameter>
        <parameter key="liip_imagine.cache.path.resolver.class">Liip\ImagineBundle\Imagine\CachePathResolver</parameter>
        <parameter key="liip_imagine.loader.filesystem.class">Liip\ImagineBundle\Imagine\DataLoader\FileSystemLoader</parameter>

        <!-- Controller class -->

        <parameter key="liip_imagine.controller.class">Liip\ImagineBundle\Controller\ImagineController</parameter>

        <!-- Route loader class -->

        <parameter key="liip_imagine.routing.loader.class">Liip\ImagineBundle\Routing\ImagineLoader</parameter>

        <!-- Templating classes -->

        <parameter key="liip_imagine.twig.extension.class">Liip\ImagineBundle\Templating\ImagineExtension</parameter>
        <parameter key="liip_imagine.templating.helper.class">Liip\ImagineBundle\Templating\Helper\ImagineHelper</parameter>

        <!-- ImagineInterface implementations -->

        <parameter key="liip_imagine.gd.class">Imagine\Gd\Imagine</parameter>
        <parameter key="liip_imagine.imagick.class">Imagine\Imagick\Imagine</parameter>
        <parameter key="liip_imagine.gmagick.class">Imagine\Gmagick\Imagine</parameter>

        <!-- Filter loaders' classes -->

        <parameter key="liip_imagine.filter.loader.thumbnail.class">Liip\ImagineBundle\Imagine\Filter\Loader\ThumbnailFilterLoader</parameter>

    </parameters>

    <services>
        
        <!-- Utility services -->

        <service id="liip_imagine.cache.path.resolver" class="%liip_imagine.cache.path.resolver.class%">
            <argument type="service" id="router" />
            <argument type="service" id="filesystem" />
            <argument>%liip_imagine.web_root%</argument>
        </service>

        <service id="liip_imagine.filter.manager" class="%liip_imagine.filter.manager.class%">
            <argument>%liip_imagine.filters%</argument>
        </service>

        <service id="liip_imagine.loader.filesystem" class="%liip_imagine.loader.filesystem.class%">
            <argument type="service" id="imagine" />
            <argument>%liip_imagine.web_root%</argument>
            <argument>%liip_imagine.formats%</argument>
        </service>

        <!-- Controller -->

        <service id="liip_imagine.controller" class="%liip_imagine.controller.class%">
            <argument type="service" id="liip_imagine.loader.filesystem" />
            <argument type="service" id="liip_imagine.filter.manager" />
        </service>

        <!-- Route Loader -->

        <service id="liip_imagine.routing.loader" class="%liip_imagine.routing.loader.class%">
            <tag name="routing.loader" />
            <argument>%liip_imagine.cache_prefix%</argument>
            <argument>%liip_imagine.filters%</argument>
        </service>

        <!-- ImagineInterface instances -->
        
        <service id="imagine" alias="liip_imagine.gd" />

        <service id="liip_imagine.gd" class="%liip_imagine.gd.class%" />

        <service id="liip_imagine.imagick" class="%liip_imagine.imagick.class%" />

        <service id="liip_imagine.gmagick" class="%liip_imagine.gmagick.class%" />

        <!--  Templating helpers and extensions -->

        <service id="liip_imagine.twig.extension" class="%liip_imagine.twig.extension.class%" public="false">
            <tag name="twig.extension" />
            <argument type="service" id="liip_imagine.cache.path.resolver" />
        </service>

        <service id="liip_imagine.templating.helper" class="%liip_imagine.templating.helper.class%">
            <tag name="templating.helper" alias="imagine" />
            <argument type="service" id="liip_imagine.cache.path.resolver" />
        </service>

        <!-- Filter loaders -->

        <service id="liip_imagine.filter.loader.thumbnail" class="%liip_imagine.filter.loader.thumbnail.class%">
            <tag name="liip_imagine.filter.loader" filter="thumbnail" />
        </service>

    </services>
</container>
